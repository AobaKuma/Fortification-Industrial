<?xml version="1.0" encoding="utf-8"?>
<Patch>

	<Operation Class="PatchOperationFindMod">
		<mods>
			<li>Combat Extended</li>
		</mods>
		<match Class="PatchOperationSequence">
			<operations>

				<!-- === Turret Bases === -->
				
				<li Class="PatchOperationRemove">
					<xpath>
						Defs/ThingDef[defName="FT_TurretHexMortar" or defName="FT_TurretPrince" or defName="FT_TurretEmpero"]/comps/li[@Class = "CompProperties_Explosive"] |
						Defs/ThingDef[defName="FT_TurretHexMortar" or defName="FT_TurretPrince" or defName="FT_TurretEmpero"]/comps/li[@Class = "CompProperties_Refuelable"] |
						Defs/ThingDef[defName="FT_TurretHexMortar" or defName="FT_TurretPrince" or defName="FT_TurretEmpero"]/inspectorTabs |
						Defs/ThingDef[defName="FT_TurretHexMortar" or defName="FT_TurretPrince" or defName="FT_TurretEmpero"]/comps/li[@Class="VFESecurity.CompProperties_LongRangeArtillery"] |
						Defs/ThingDef[defName="FT_TurretHexMortar" or defName="FT_TurretPrince" or defName="FT_TurretEmpero"]/building/buildingTags
					</xpath>
				</li>

				<li Class="PatchOperationAdd">
					<xpath>Defs/ThingDef[defName="FT_TurretHexMortar" or defName="FT_TurretPrince" or defName="FT_TurretEmpero"]/building</xpath>
					<value>
						<spawnedConceptLearnOpportunity>CE_MortarDirectFire</spawnedConceptLearnOpportunity>
					</value>
				</li>

				<li Class="PatchOperationReplace">
					<xpath>Defs/ThingDef[defName="FT_TurretHexMortar" or defName="FT_TurretPrince" or defName="FT_TurretEmpero"]/building/turretBurstCooldownTime</xpath>
					<value>
          				<turretBurstCooldownTime>1</turretBurstCooldownTime>
					</value>
				</li>
				<!-- === Multi-Mortar / Nebelwerfer === -->

				<li Class="CombatExtended.PatchOperationMakeGunCECompatible">
					<defName>FT_Gun_TurretHexMortar</defName>
					<statBases>
						<RangedWeapon_Cooldown>4</RangedWeapon_Cooldown>
						<SightsEfficiency>0.5</SightsEfficiency>
						<ShotSpread>2</ShotSpread>
						<SwayFactor>0.5</SwayFactor>
					</statBases>
					<Properties>
						<verbClass>CombatExtended.Verb_ShootMortarCE</verbClass>
						<forceNormalTimeSpeed>false</forceNormalTimeSpeed>
						<hasStandardCommand>true</hasStandardCommand>
						<requireLineOfSight>false</requireLineOfSight>
						<defaultProjectile>Bullet_FT_15cmNebelwerfer_HE</defaultProjectile>
						<warmupTime>4</warmupTime>
						<minRange>40</minRange>
						<range>1000</range>
						<burstShotCount>6</burstShotCount>
						<ticksBetweenBurstShots>10</ticksBetweenBurstShots>
						<soundCast>FT_NebelShot</soundCast>
						<muzzleFlashScale>39</muzzleFlashScale>
						<circularError>1.5</circularError>
						<indirectFirePenalty>0.3</indirectFirePenalty>
						<targetParams>
							<canTargetLocations>true</canTargetLocations>
						</targetParams>
						<recoilAmount>0.0</recoilAmount>
					</Properties>
					<AmmoUser>
						<magazineSize>6</magazineSize>
						<reloadOneAtATime>true</reloadOneAtATime>
						<reloadTime>2.5</reloadTime>
						<ammoSet>AmmoSet_FT_15cmNebelwerfer</ammoSet>
					</AmmoUser>
					<FireModes>
						<aimedBurstShotCount>3</aimedBurstShotCount>
						<aiUseBurstMode>true</aiUseBurstMode>
						<aiAimMode>SuppressFire</aiAimMode>
						<noSingleShot>true</noSingleShot>
					</FireModes>
					<weaponTags>
					  <li>TurretGun</li>
					</weaponTags>
				  </li>		
				<li Class="PatchOperationAdd">
					<xpath>Defs/ThingDef[defName="FT_Gun_TurretHexMortar"]/comps</xpath>
					<value>
						<li Class="CombatExtended.CompProperties_Charges">
							<chargeSpeeds>
								<li>30</li>
								<li>35</li>
								<li>40</li>
								<li>45</li>
								<li>50</li>
								<li>55</li>
								<li>60</li>
								<li>65</li>
								<li>70</li>
								<li>75</li>
								<li>80</li>
								<li>85</li>
								<li>90</li>
								<li>95</li>
								<li>100</li>
								<li>105</li>
								<li>110</li>
								<li>115</li>
								<li>120</li>
								<li>125</li>
								<li>130</li>
								<li>135</li>
								<li>140</li>
								<li>145</li>
								<li>150</li>
								<li>155</li>
								<li>160</li>
								<li>165</li>
								<li>170</li>
								<li>175</li>
								<li>180</li>
								<li>185</li>
								<li>190</li>
								<li>195</li>
								<li>200</li>
							</chargeSpeeds>
						</li>
					</value>
				</li>

				<!-- === 155mm Artillery / NK-33L "Prince" === -->

				<li Class="CombatExtended.PatchOperationMakeGunCECompatible">
					<defName>FT_Gun_TurretPrince</defName>
					<statBases>
						<RangedWeapon_Cooldown>4</RangedWeapon_Cooldown>
						<SightsEfficiency>0.5</SightsEfficiency>
						<ShotSpread>2</ShotSpread>
						<SwayFactor>0.5</SwayFactor>
					</statBases>
					<Properties>
						<verbClass>CombatExtended.Verb_ShootMortarCE</verbClass>
						<forceNormalTimeSpeed>false</forceNormalTimeSpeed>
						<hasStandardCommand>true</hasStandardCommand>
						<requireLineOfSight>false</requireLineOfSight>
						<defaultProjectile>Bullet_155mmHowitzerShell_HE</defaultProjectile>
						<warmupTime>4</warmupTime>
						<minRange>50</minRange>
						<range>1000</range>
						<soundCast>FT_CannonLaunchB</soundCast>
						<soundCastTail>GunTail_Heavy</soundCastTail>
						<muzzleFlashScale>16</muzzleFlashScale>
						<circularError>1</circularError>
						<indirectFirePenalty>0.4</indirectFirePenalty>
						<targetParams>
							<canTargetLocations>true</canTargetLocations>
						</targetParams>
					</Properties>
					<AmmoUser>
						<magazineSize>1</magazineSize>
						<reloadTime>10</reloadTime>
						<ammoSet>AmmoSet_155mmHowitzerShell</ammoSet>
					</AmmoUser>
					<FireModes>
						<aimedBurstShotCount>3</aimedBurstShotCount>
						<aiUseBurstMode>true</aiUseBurstMode>
						<aiAimMode>SuppressFire</aiAimMode>
						<noSingleShot>true</noSingleShot>
					</FireModes>
					<weaponTags>
					  <li>TurretGun</li>
					</weaponTags>
				  </li>

				<li Class="PatchOperationReplace">
					<xpath>Defs/ThingDef[defName="FT_Gun_TurretPrince"]/label</xpath>
					<value>
						<label>155mm howitzer</label>
					</value>
				</li>
				<li Class="PatchOperationAdd">
					<xpath>Defs/ThingDef[defName="FT_Gun_TurretPrince"]/comps</xpath>
					<value>
						<li Class="CombatExtended.CompProperties_Charges">
							<chargeSpeeds>
								<li>30</li>
								<li>35</li>
								<li>40</li>
								<li>45</li>
								<li>50</li>
								<li>55</li>
								<li>60</li>
								<li>65</li>
								<li>70</li>
								<li>75</li>
								<li>80</li>
								<li>85</li>
								<li>90</li>
								<li>95</li>
								<li>100</li>
							</chargeSpeeds>
						</li>
					</value>
				</li>

				<!-- === 155mm Field Cannon / NK-30 "Empero" === -->
				<li Class="CombatExtended.PatchOperationMakeGunCECompatible">
					<defName>FT_Gun_TurretEmpero</defName>
					<statBases>
						<RangedWeapon_Cooldown>8.0</RangedWeapon_Cooldown>
						<SightsEfficiency>2.18</SightsEfficiency>
						<ShotSpread>0.01</ShotSpread>
						<SwayFactor>1.50</SwayFactor>
						<DeteriorationRate>0</DeteriorationRate>
						<Mass>205</Mass>
						<Flammability>0</Flammability>
					</statBases>
					<Properties>
						<verbClass>CombatExtended.Verb_ShootCE</verbClass>
						<hasStandardCommand>true</hasStandardCommand>
						<defaultProjectile>Bullet_155mmHowitzerShell_HE_directfire</defaultProjectile>
						<warmupTime>4</warmupTime>
						<minRange>14.9</minRange>
						<range>1000</range>
						<soundCast>FT_CannonLaunchC</soundCast>
						<soundCastTail>GunTail_Heavy</soundCastTail>
						<muzzleFlashScale>32</muzzleFlashScale>
						<targetParams>
							<canTargetLocations>true</canTargetLocations>
						</targetParams>
						<recoilPattern>Mounted</recoilPattern>
					</Properties>
					<AmmoUser>
						<magazineSize>1</magazineSize>
						<reloadTime>10</reloadTime>
						<ammoSet>AmmoSet_155mmHowitzerShell_directfire</ammoSet>
					</AmmoUser>
					<FireModes>
						<aiUseBurstMode>false</aiUseBurstMode>
					</FireModes>
					<weaponTags>
					  <li>TurretGun</li>
					</weaponTags>
				  </li>

				<li Class="PatchOperationReplace">
					<xpath>Defs/ThingDef[defName="FT_Gun_TurretEmpero"]/label</xpath>
					<value>
						<label>155mm field cannon</label>
					</value>
				</li>
				<li Class="PatchOperationReplace">
					<xpath>Defs/ThingDef[defName="FT_Gun_TurretEmpero"]/description</xpath>
					<value>
						<description>A powerful direct-firing cannon with highaccuracy.</description>
					</value>
				</li>

			</operations>
		</match>
	</Operation>

</Patch>